@model IEnumerable<AlfaPeople.KingKhalidFoundation.Data.Model.IncubationWorkshop>
@{
    Layout = "~/Views/Shared/_LayoutPage.cshtml";
}
<!-- Content -->
<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="toolbar">
                            <a href="@Url.Action( "Create")" class="btn btn-link btn-info btn-just-icon like">
                                <i class="material-icons">add</i>
                            </a>
                        </div>
                        <div class="material-datatables">
                            <table id="datatables" class="table table-striped table-no-bordered table-hover" cellspacing="0"
                                   width="100%" style="width:100%">
                                <thead>
                                    <tr>
                                        <th>
                                            @Resources.IncubationWorkshops.WorkshopName
                                        </th>
                                        <th>
                                            @Resources.IncubationWorkshops.WorkshopModel
                                        </th>
                                        <th>
                                            @Resources.IncubationWorkshops.StartDate
                                        </th>
                                        <th>
                                            @Resources.IncubationWorkshops.EndDate
                                        </th>
                                        <th>
                                            @Resources.IncubationWorkshops.WorkshopStatus
                                        </th>
                                        <th>
                                            @Resources.General.Actions
                                        </th>

                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Name)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IncubationWorkshopModel.NameEN)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.StartDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.EndDate)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.IncubationtWorkshopStatu.NameEN)
                                            </td>
                                            <td>
                                                <a class="btn btn-link btn-warning btn-just-icon edit" title="@Resources.General.Edit" href="@Url.Action("Edit", new { id = item.IncubationWorkshopID })"><i class="material-icons">edit</i></a>
                                                <a class="btn btn-link btn-warning btn-just-icon" title="@Resources.Workshop.WorkshopInvitations" href="@Url.Action("WorkshopInvitations", new { workshopId = item.IncubationWorkshopID })"><i class="material-icons">how_to_vote</i></a>
                                                <a class="btn btn-link btn-warning btn-just-icon" title="@Resources.AttendeesList.WorkshopAttendance" href="@Url.Action("AttendeesList", new { workshopId = item.IncubationWorkshopID })"><i class="material-icons">assignment_ind</i></a>
                                                <a class="btn btn-link"
                                                   title="تصدير الحضور"
                                                   href="@Url.Action("ExportAttendanceToExcel","IncubationWorkshops", new { workshopId = item.IncubationWorkshopID })">
                                                    <i class="material-icons">file_download</i>
                                                </a>

                                                @if (item.IncubationWorkshopRatings.Count > 0)
                                                {
                                                    <a class="btn btn-link btn-warning btn-just-icon" title="@Resources.IncubationWorkshopRating.WorkshopRating" href="@Url.Action("Index", "IncubationWorkshopRating", new { Id = item.IncubationWorkshopID })"><i class="material-icons">bookmark</i></a>
                                                }
                                                else
                                                {
                                                    <button class="btn btn-link btn-warning btn-just-icon chart" title="@Resources.IncubationWorkshopRating.WorkshopRating"><i class="material-icons">bookmark</i></button>
                                                }
                                                @* 2-25-2025 *@
                                                <!-- إضافة زر الحذف مع تأكيد -->

                                                <button type="button" class="btn btn-link btn-danger btn-just-icon remove" onclick="deleteworkshop('@item.IncubationWorkshopID')">
                                                    <i class="material-icons">delete</i>
                                                </button>



                                                @*<a class="btn btn-link btn-success btn-just-icon"
           title="@Resources.General.ShareLink"
           href="@Url.Action("PublicWorkshopDetails", "IncubationWorkshops", new { id = item.IncubationWorkshopID })"
           target="_blank">
            <i class="material-icons">link</i>
        </a>*@
                                                @*<a class="btn btn-link btn-info btn-just-icon" title="@Resources.General.ShareLink"
           onclick="copyToClipboard('@Url.Action("PublicWorkshopDetails", "IncubationWorkshops", new { id = item.IncubationWorkshopID }, Request.Url.Scheme)')">
            <i class="material-icons">share</i>
        </a>*@
                                                <a href="javascript:void(0)" onclick="copyToClipboard('@Url.Action("PublicWorkshopDetails", "IncubationWorkshops", new { id = item.IncubationWorkshopID }, Request.Url.Scheme)')" ,class="btn btn-link btn-info btn-just-icon" ,title="@Resources.General.ShareLink">
                                                    <i class="material-icons">share</i>
                                                </a>



                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- end content-->



@section Scripts{
    @*<script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function () {
                alert("تم نسخ رابط المشاركة بنجاح!");
            }, function (err) {
                alert("حدث خطأ أثناء النسخ: " + err);
            });
        }
    </script>*@
<script>
    function copyToClipboard(text) {
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(function () {
                alert("تم نسخ الرابط بنجاح");
            }, function (err) {
                alert("فشل النسخ: " + err);
            });
        } else {
            // fallback
            const textArea = document.createElement("textarea");
            textArea.value = text;
            // لتجنب ظهور النص للمستخدم
            textArea.style.position = "fixed";
            textArea.style.top = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                document.execCommand('copy');
                alert("تم نسخ الرابط بنجاح");
            } catch (err) {
                alert("فشل النسخ");
            }

            document.body.removeChild(textArea);
        }
    }

    </script>
    <script>
        $(".chart").click(function () {
            md.showNotification('top', '@Resources.General.MsgTextAlign', 'notification_important', 'rose', '3e3', '<h4 class="info-text" style="text-align:@Resources.General.TextAlign;"> @Resources.IncubationWorkshopRating.WorkshopNotEvaluated </h4>')
        });
    </script>

    <script>
        window.onload = function (e) {
            $('#navItem_IncubationWorkshops').addClass('active');
            $('#Workshop').addClass('show');
        };
    </script>

    <script>
        $(function () {
            if ('@Resources.General.lang' == 'ar') {
                $("#datatables").DataTable({
                    "language": {
                        "url": "https://cdn.datatables.net/plug-ins/9dcbecd42ad/i18n/Arabic.json"
                    }
                });
            } else {
                $("#datatables").DataTable();
            }
        });
    </script>
    <script>
        function deleteworkshop(id) {
    if (confirm('هل أنت متأكد من حذف ورشة العمل؟ .')) {
        $.ajax({
            url: '@Url.Action("DeleteWorkshop", "IncubationWorkshops")',
            type: 'POST',
            data: { id: id },
            success: function (response) {
                if (response.success) {
                    md.showNotification(
                        'top', '@Resources.General.MsgTextAlign',
                        'check_circle', 'success', '3e3',
                        '<h4 class="info-text" style="text-align:@Resources.General.TextAlign;">' + response.message + '</h4>');
                    location.reload();
                } else {
                    md.showNotification('top', '@Resources.General.MsgTextAlign',
                        'error', 'danger', '3e3',
                        '<h4 class="info-text" style="text-align:@Resources.General.TextAlign;">' + response.message + '</h4>');
                }
            },
            error: function () {
                md.showNotification('top', '@Resources.General.MsgTextAlign',
                    'error', 'danger', '3e3',
                    '<h4 class="info-text" style="text-align:@Resources.General.TextAlign;">حدث خطأ أثناء حذف ورشة العمل.</h4>');
            }
        });
    }
}
    </script>
}